<!DOCTYPE html>
<html>
<head>
  <title>IPTV播放网站</title>
  <link href="https://cdn.bootcdn.net/ajax/libs/video.js/8.5.3/alt/video-js-cdn.min.css" rel="stylesheet">
</head>
<body>
  <h1>频道列表</h1>
  <div id="player-container">
    <video id="player" class="video-js vjs-default-skin" controls preload="auto" width="640" height="360"></video>
  </div>
  <ul id="channel-list"></ul>

  <script src="https://cdn.bootcdn.net/ajax/libs/video.js/8.5.3/alt/video.core.min.js"></script>
  <script>
    // M3U文件的URL
    var m3uUrl = "v6.m3u";

    // 获取M3U文件内容
    fetch(m3uUrl)
      .then(response => response.text())
      .then(data => {
        // 解析M3U文件内容
        var channels = parseM3U(data);

        // 显示频道列表
        var channelList = document.getElementById("channel-list");
        channels.forEach(channel => {
          var listItem = document.createElement("li");

          // 创建频道图片
          var channelImage = document.createElement("img");
          channelImage.src = channel.logo;
          channelImage.alt = channel.name;
          listItem.appendChild(channelImage);

          // 创建频道名称
          var channelName = document.createElement("span");
          channelName.textContent = channel.name;
          listItem.appendChild(channelName);

          // 添加点击事件处理程序，点击时播放频道
          listItem.addEventListener("click", function() {
            playChannel(channel.url);
          });

          channelList.appendChild(listItem);
        });
      })
      .catch(error => {
        console.error("无法加载M3U文件: " + error);
      });

    // 解析M3U文件内容
    function parseM3U(m3uData) {
      var lines = m3uData.split("\n");
      var channels = [];

      // 逐行解析M3U文件
      for (var i = 0; i < lines.length; i++) {
        var line = lines[i].trim();

        // 解析频道信息
        if (line.startsWith("#EXTINF")) {
          var info = line.substring(line.indexOf(",") + 1).trim();
          var name = info.split(" ")[0].trim();
          var url = lines[i + 1].trim();
          var logo = "";

          // 提取图像链接
          var logoMatch = line.match(/tvg-logo="([^"]+)"/);
          if (logoMatch && logoMatch.length > 1) {
            logo = logoMatch[1];
          }

          channels.push({ name: name, url: url, logo: logo });
        }
      }

      return channels;
    }

    // 播放频道
    function playChannel(url) {
      var player = videojs("player");
      player.src({ src: url, type: "application/x-mpegURL" });
      player.play();
    }
  </script>
</body>
</html>